<?xml-model href="./FactDictionaryModule.rng"?>
<FactDictionaryModule>
  <Facts>
    <Fact path="/claimedSpouseCombatPayWithoutMFJ">
      <Name>Claimed Spouse Combat Pay without a Spouse</Name>
      <Description>Filer selected a combat pay option referencing a spouse without having a spouse</Description>
      <BlockSubmissionOnTrue />

      <Derived>
        <All>
          <IsComplete>
            <Dependency path="/combatPayElection" />
          </IsComplete>
          <Not>
            <Dependency module="filingStatus" path="/isFilingStatusMFJ" />
          </Not>
          <Any>
            <Equal>
              <Left>
                <Dependency path="/combatPayElection" />
              </Left>
              <Right>
                <Enum optionsPath="/combatPayOptions">useSpouseCombatPay</Enum>
              </Right>
            </Equal>
            <Equal>
              <Left>
                <Dependency path="/combatPayElection" />
              </Left>
              <Right>
                <Enum optionsPath="/combatPayOptions">useBothCombatPay</Enum>
              </Right>
            </Equal>
          </Any>
        </All>
      </Derived>
    </Fact>

    <Fact path="/combatPayElection">
      <Name>Combat pay election</Name>
      <Description>Whether the taxpayer elects to include their nontaxable combat pay for EITC.

        They may choose to elect
        their own combat pay, their spouse's combat pay separately, or both of their combat pay should they each have
        combat pay.</Description>
      <Export downstreamFacts="true" />

      <Writable>
        <Enum optionsPath="/combatPayOptions" />
      </Writable>
    </Fact>


    <Fact path="/earnedIncomeCredit">
      <Name>Earned income credit (EITC)</Name>
      <Description>Earned income credit (EITC) (line 27 1040)

        We calculate the EITC up to four times -- EITC may be
        calculated with:
        1. No combat pay (for people without combat pay, and people who elect not to include their
        combat pay)
        2. With the primary filer's combat pay
        3. With the secondary filer's combat pay
        4. With both filer's
        combined combat pay.

        If a user qualifies for more than 1 of those options (most taxpayers do not have combat pay
        and will therefore default into the "no combat pay" option), we guide the taxpayer towards electing the combat
        pay option that will give them the most EITC.
      </Description>
      <Export downstreamFacts="true" mef="true" />

      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/eitcQualified" />
            </When>
            <Then>
              <Switch>
                <Case>
                  <When>
                    <All>
                      <Dependency module="formW2s" path="/someFilerHasCombatPay" />
                      <Equal>
                        <Left>
                          <Dependency path="/combatPayElectionAndOrRecommendation" />
                        </Left>
                        <Right>
                          <Enum optionsPath="/combatPayOptions">usePrimaryCombatPay</Enum>
                        </Right>
                      </Equal>
                    </All>
                  </When>
                  <Then>
                    <Dependency path="/eitcAmountWithPrimaryCombatPay" />
                  </Then>
                </Case>
                <Case>
                  <When>
                    <All>
                      <Dependency module="formW2s" path="/someFilerHasCombatPay" />
                      <Equal>
                        <Left>
                          <Dependency path="/combatPayElectionAndOrRecommendation" />
                        </Left>
                        <Right>
                          <Enum optionsPath="/combatPayOptions">useSpouseCombatPay</Enum>
                        </Right>
                      </Equal>
                    </All>
                  </When>
                  <Then>
                    <Dependency path="/eitcAmountWithSecondaryCombatPay" />
                  </Then>
                </Case>
                <Case>
                  <When>
                    <All>
                      <Dependency module="formW2s" path="/someFilerHasCombatPay" />
                      <Equal>
                        <Left>
                          <Dependency path="/combatPayElectionAndOrRecommendation" />
                        </Left>
                        <Right>
                          <Enum optionsPath="/combatPayOptions">useBothCombatPay</Enum>
                        </Right>
                      </Equal>
                    </All>
                  </When>
                  <Then>
                    <Dependency path="/eitcAmountWithBothTPCombatPay" />
                  </Then>
                </Case>
                <Case>
                  <When>
                    <All>
                      <Dependency module="formW2s" path="/someFilerHasCombatPay" />
                      <Equal>
                        <Left>
                          <Dependency path="/combatPayElectionAndOrRecommendation" />
                        </Left>
                        <Right>
                          <Enum optionsPath="/combatPayOptions">usePrimaryNotSpouseCombatPay</Enum>
                        </Right>
                      </Equal>
                    </All>
                  </When>
                  <Then>
                    <Dependency path="/eitcAmountWithPrimaryCombatPay" />
                  </Then>
                </Case>
                <Case>
                  <When>
                    <All>
                      <Dependency module="formW2s" path="/someFilerHasCombatPay" />
                      <Equal>
                        <Left>
                          <Dependency path="/combatPayElectionAndOrRecommendation" />
                        </Left>
                        <Right>
                          <Enum optionsPath="/combatPayOptions">useSpouseNotPrimaryCombatPay</Enum>
                        </Right>
                      </Equal>
                    </All>
                  </When>
                  <Then>
                    <Dependency path="/eitcAmountWithSecondaryCombatPay" />
                  </Then>
                </Case>
                <Case>
                  <When>
                    <!-- There has not been a combat pay election, or the user chose "noCombatPay" -->
                    <True />
                  </When>
                  <Then>
                    <Dependency path="/eitcAmountWithoutCombatPay" />
                  </Then>
                </Case>
              </Switch>
            </Then>
          </Case>
          <Case>
            <When>
              <True />
            </When>
            <Then>
              <Dollar>0</Dollar>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/isReceivingEitc">
      <Name>Is receiving EITC</Name>
      <Description>Whether the TP is receiving EITC</Description>
      <Export downstreamFacts="true" mef="true" />

      <Derived>
        <GreaterThan>
          <Left>
            <Dependency path="/earnedIncomeCredit" />
          </Left>
          <Right>
            <Dollar>0</Dollar>
          </Right>
        </GreaterThan>
      </Derived>
    </Fact>

    <Fact path="/maxEitcFromAGI">
      <Description>
        The maximum amount of EITC that can be receieved based on the taxpayer's AGI.
      </Description>

      <Derived>
        <Subtract>
          <Minuend>
            <Dependency path="/eitcMaxCredit" />
          </Minuend>

          <Subtrahends>
            <Switch>
              <Case>
                <!-- If the threshold is greater than the lower bound of the row, we don't apply any phaseout -->
                <When>
                  <GreaterThan>
                    <Left>
                      <Add>
                        <Dependency path="/eitcPhaseOutThreshold" />
                        <Dollar>25</Dollar>
                      </Add>
                    </Left>
                    <Right>
                      <Dependency path="/eitcRoundedAGI" />
                    </Right>
                  </GreaterThan>
                </When>
                <Then>
                  <Dollar>0</Dollar>
                </Then>
              </Case>
              <Case>
                <When>
                  <True />
                </When>
                <Then>
                  <Multiply> <!-- Phaseout for income over the threshold -->
                    <Dependency path="/eitcPhaseOutRate" />
                    <Subtract>
                      <Minuend>
                        <LesserOf>
                          <!-- The midpoint of the row -->
                          <Dependency path="/eitcRoundedAGI" />
                          <!-- The midpoint of the lower bound of the row and the completed phaseout amount-->
                          <Divide>
                            <Dividend>
                              <Add>
                                <Dependency path="/eitcPhaseoutAmountLowerBound" />
                                <Dependency path="/eitcCompletedPhaseoutAmount" />
                              </Add>
                            </Dividend>
                            <Divisors>
                              <Int>2</Int>
                            </Divisors>
                          </Divide>
                        </LesserOf>
                      </Minuend>
                      <Subtrahends>
                        <Dependency path="/eitcPhaseOutThreshold" />
                      </Subtrahends>
                    </Subtract>
                  </Multiply>
                </Then>
              </Case>
            </Switch>
          </Subtrahends>
        </Subtract>
      </Derived>
    </Fact>

    <Fact path="/eitcAmountWithoutCombatPay">
      <Name>The amount of the Earned Income Tax Credit without combat pay</Name>
      <Description>The amount of EITC, if the taxpayer is eligible. Magic numbers come from
        https://www.irs.gov/pub/irs-drop/rp-21-45.pdf and will need to be updated for 2023 with
        https://www.irs.gov/pub/irs-drop/rp-22-38.pdf</Description>

      <Derived>
        <GreaterOf> <!-- Cannot be less than zero -->
          <Dollar>0</Dollar>
          <Round>
            <LesserOf>
              <Dependency path="/maxEitcFromAGI" />
              <Subtract>
                <Minuend>
                  <Switch>
                    <!-- If the upper band of the row would exceed the max credit, use the max credit -->
                    <Case>
                      <When>
                        <GreaterThanOrEqual>
                          <Left>
                            <Multiply> <!-- Multiply earned income by the phase in rate -->
                              <Dependency path="/eitcPhaseInRate" />
                              <Add>
                                <Dependency path="/eitcRoundedEarnedIncomeWithoutCombatPay" />
                                <Dollar>24</Dollar>
                              </Add>
                            </Multiply>
                          </Left>
                          <Right>
                            <Dependency path="/eitcMaxCredit" />
                          </Right>
                        </GreaterThanOrEqual>
                      </When>
                      <Then>
                        <Dependency path="/eitcMaxCredit" />
                      </Then>
                    </Case>
                    <!-- Otherwise, use the normal calculation -->
                    <Case>
                      <When>
                        <True />
                      </When>
                      <Then>
                        <LesserOf> <!-- Cannot exceed the limit -->
                          <Dependency path="/eitcMaxCredit" />
                          <Multiply> <!-- Multiply earned income by the phase in rate -->
                            <Dependency path="/eitcPhaseInRate" />
                            <Dependency path="/eitcRoundedEarnedIncomeWithoutCombatPay" />
                          </Multiply>
                        </LesserOf>
                      </Then>
                    </Case>
                  </Switch>
                </Minuend>

                <Subtrahends>
                  <Switch>
                    <Case>
                      <!-- If the threshold is greater than the lower bound of the row, we don't apply any phaseout -->
                      <When>
                        <GreaterThan>
                          <Left>
                            <Add>
                              <Dependency path="/eitcPhaseOutThreshold" />
                              <Dollar>25</Dollar>
                            </Add>
                          </Left>
                          <Right>
                            <Dependency path="/eitcRoundedEarnedIncomeWithoutCombatPay" />
                          </Right>
                        </GreaterThan>
                      </When>
                      <Then>
                        <Dollar>0</Dollar>
                      </Then>
                    </Case>
                    <Case>
                      <When>
                        <True />
                      </When>
                      <Then>
                        <Multiply> <!-- Phaseout for income over the threshold -->
                          <Dependency path="/eitcPhaseOutRate" />
                          <Subtract>
                            <Minuend>
                              <LesserOf>
                                <!-- The midpoint of the row -->
                                <Dependency path="/eitcRoundedEarnedIncomeWithoutCombatPay" />
                                <!-- The midpoint of the lower bound of the row and the completed phaseout amount-->
                                <Divide>
                                  <Dividend>
                                    <Add>
                                      <Dependency path="/eitcPhaseoutAmountLowerBound" />
                                      <Dependency path="/eitcCompletedPhaseoutAmount" />
                                    </Add>
                                  </Dividend>
                                  <Divisors>
                                    <Int>2</Int>
                                  </Divisors>
                                </Divide>
                              </LesserOf>
                            </Minuend>
                            <Subtrahends>
                              <Dependency path="/eitcPhaseOutThreshold" />
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Then>
                    </Case>
                  </Switch>
                </Subtrahends>
              </Subtract>
            </LesserOf>
          </Round>
        </GreaterOf>
      </Derived>
    </Fact>

    <Fact path="/eitcRoundedEarnedIncomeWithoutCombatPay">
      <Name>Rounded earned income for EITC without combat pay</Name>
      <Description>In order to match the EITC table from Publication 596, we must round the income to match the rows,
        which use increments of $50, calculating the amount of the credit for the midpoint of row (i.e. $25, $75, $125,
        etc.).</Description>
      <Derived>
        <Add>
          <StepwiseMultiply>
            <Multiplicand>
              <Dependency module="income" path="/employerIncomeSubtotal" />
            </Multiplicand>
            <Rate>
              <Rational>50/50</Rational> <!-- $50 for every whole $50 of income -->
            </Rate>
          </StepwiseMultiply>
          <Dollar>25</Dollar> <!-- Add $25 to find the midpoint of the row -->
        </Add>
      </Derived>
    </Fact>

    <Fact path="/eitcAmountWithPrimaryCombatPay">
      <Name>The amount of the Earned Income Tax Credit with primary filer combat pay</Name>
      <Description>The amount of EITC, if the taxpayer is eligible. Magic numbers come from
        https://www.irs.gov/pub/irs-drop/rp-21-45.pdf and will need to be updated for 2023 with
        https://www.irs.gov/pub/irs-drop/rp-22-38.pdf</Description>

      <Derived>
        <GreaterOf> <!-- Cannot be less than zero -->
          <Dollar>0</Dollar>
          <Round>
            <LesserOf>
              <Dependency path="/maxEitcFromAGI" />
              <Subtract>
                <Minuend>
                  <Switch>
                    <!-- If the upper band of the row would exceed the max credit, use the max credit -->
                    <Case>
                      <When>
                        <GreaterThanOrEqual>
                          <Left>
                            <Multiply> <!-- Multiply earned income by the phase in rate -->
                              <Dependency path="/eitcPhaseInRate" />
                              <Add>
                                <Dependency path="/eitcRoundedEarnedIncomeWithPrimaryCombatPay" />
                                <Dollar>24</Dollar>
                              </Add>
                            </Multiply>
                          </Left>
                          <Right>
                            <Dependency path="/eitcMaxCredit" />
                          </Right>
                        </GreaterThanOrEqual>
                      </When>
                      <Then>
                        <Dependency path="/eitcMaxCredit" />
                      </Then>
                    </Case>
                    <!-- Otherwise, use the normal calculation -->
                    <Case>
                      <When>
                        <True />
                      </When>
                      <Then>
                        <LesserOf> <!-- Cannot exceed the limit -->
                          <Dependency path="/eitcMaxCredit" />
                          <Multiply> <!-- Multiply earned income by the phase in rate -->
                            <Dependency path="/eitcPhaseInRate" />
                            <Dependency path="/eitcRoundedEarnedIncomeWithPrimaryCombatPay" />
                          </Multiply>
                        </LesserOf>
                      </Then>
                    </Case>
                  </Switch>
                </Minuend>

                <Subtrahends>
                  <Switch>
                    <Case>
                      <!-- If the threshold is greater than the lower bound of the row, we don't apply any phaseout -->
                      <When>
                        <GreaterThan>
                          <Left>
                            <Add>
                              <Dependency path="/eitcPhaseOutThreshold" />
                              <Dollar>25</Dollar>
                            </Add>
                          </Left>
                          <Right>
                            <Dependency path="/eitcRoundedEarnedIncomeWithPrimaryCombatPay" />
                          </Right>
                        </GreaterThan>
                      </When>
                      <Then>
                        <Dollar>0</Dollar>
                      </Then>
                    </Case>
                    <Case>
                      <When>
                        <True />
                      </When>
                      <Then>
                        <Multiply> <!-- Phaseout for income over the threshold -->
                          <Dependency path="/eitcPhaseOutRate" />
                          <Subtract>
                            <Minuend>
                              <LesserOf>
                                <!-- The midpoint of the row -->
                                <Dependency path="/eitcRoundedEarnedIncomeWithPrimaryCombatPay" />
                                <!-- The midpoint of the lower bound of the row and the completed phaseout amount-->
                                <Divide>
                                  <Dividend>
                                    <Add>
                                      <Dependency path="/eitcPhaseoutAmountLowerBound" />
                                      <Dependency path="/eitcCompletedPhaseoutAmount" />
                                    </Add>
                                  </Dividend>
                                  <Divisors>
                                    <Int>2</Int>
                                  </Divisors>
                                </Divide>
                              </LesserOf>
                            </Minuend>
                            <Subtrahends>
                              <Dependency path="/eitcPhaseOutThreshold" />
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Then>
                    </Case>
                  </Switch>
                </Subtrahends>
              </Subtract>
            </LesserOf>
          </Round>
        </GreaterOf>
      </Derived>
    </Fact>

    <Fact path="/earnedIncomePlusPrimaryCombatPay">
      <Name>Earned income plus primary combat pay</Name>
      <Derived>
        <Add>
          <Dependency module="formW2s" path="/primaryFilerCombatPay" />
          <Dependency module="income" path="/employerIncomeSubtotal" />
        </Add>
      </Derived>
    </Fact>

    <Fact path="/eitcRoundedEarnedIncomeWithPrimaryCombatPay">
      <Name>Rounded earned income for EITC with a primary filer's combat pay</Name>
      <Description>In order to match the EITC table from Publication 596, we must round the income to match the rows,
        which use increments of $50, calculating the amount of the credit for the midpoint of row (i.e. $25, $75, $125,
        etc.).</Description>
      <Derived>
        <Add>
          <StepwiseMultiply>
            <Multiplicand>
              <Dependency path="/earnedIncomePlusPrimaryCombatPay" />
            </Multiplicand>
            <Rate>
              <Rational>50/50</Rational> <!-- $50 for every whole $50 of income -->
            </Rate>
          </StepwiseMultiply>
          <Dollar>25</Dollar> <!-- Add $25 to find the midpoint of the row -->
        </Add>
      </Derived>
    </Fact>

    <Fact path="/eitcAmountWithSecondaryCombatPay">
      <Name>The amount of the Earned Income Tax Credit with secondary filer combat pay</Name>
      <Description>The amount of EITC, if the taxpayer is eligible. Magic numbers come from
        https://www.irs.gov/pub/irs-drop/rp-21-45.pdf and will need to be updated for 2023 with
        https://www.irs.gov/pub/irs-drop/rp-22-38.pdf</Description>

      <Derived>
        <GreaterOf> <!-- Cannot be less than zero -->
          <Dollar>0</Dollar>
          <Round>
            <LesserOf>
              <Dependency path="/maxEitcFromAGI" />
              <Subtract>
                <Minuend>
                  <Switch>
                    <!-- If the upper band of the row would exceed the max credit, use the max credit -->
                    <Case>
                      <When>
                        <GreaterThanOrEqual>
                          <Left>
                            <Multiply> <!-- Multiply earned income by the phase in rate -->
                              <Dependency path="/eitcPhaseInRate" />
                              <Add>
                                <Dependency path="/eitcRoundedEarnedIncomeWithSecondaryCombatPay" />
                                <Dollar>24</Dollar>
                              </Add>
                            </Multiply>
                          </Left>
                          <Right>
                            <Dependency path="/eitcMaxCredit" />
                          </Right>
                        </GreaterThanOrEqual>
                      </When>
                      <Then>
                        <Dependency path="/eitcMaxCredit" />
                      </Then>
                    </Case>
                    <!-- Otherwise, use the normal calculation -->
                    <Case>
                      <When>
                        <True />
                      </When>
                      <Then>
                        <LesserOf> <!-- Cannot exceed the limit -->
                          <Dependency path="/eitcMaxCredit" />
                          <Multiply> <!-- Multiply earned income by the phase in rate -->
                            <Dependency path="/eitcPhaseInRate" />
                            <Dependency path="/eitcRoundedEarnedIncomeWithSecondaryCombatPay" />
                          </Multiply>
                        </LesserOf>
                      </Then>
                    </Case>
                  </Switch>
                </Minuend>

                <Subtrahends>
                  <Switch>
                    <Case>
                      <!-- If the threshold is greater than the lower bound of the row, we don't apply any phaseout -->
                      <When>
                        <GreaterThan>
                          <Left>
                            <Add>
                              <Dependency path="/eitcPhaseOutThreshold" />
                              <Dollar>25</Dollar>
                            </Add>
                          </Left>
                          <Right>
                            <Dependency path="/eitcRoundedEarnedIncomeWithSecondaryCombatPay" />
                          </Right>
                        </GreaterThan>
                      </When>
                      <Then>
                        <Dollar>0</Dollar>
                      </Then>
                    </Case>
                    <Case>
                      <When>
                        <True />
                      </When>
                      <Then>
                        <Multiply> <!-- Phaseout for income over the threshold -->
                          <Dependency path="/eitcPhaseOutRate" />
                          <Subtract>
                            <Minuend>
                              <LesserOf>
                                <!-- The midpoint of the row -->
                                <Dependency path="/eitcRoundedEarnedIncomeWithSecondaryCombatPay" />
                                <!-- The midpoint of the lower bound of the row and the completed phaseout amount-->
                                <Divide>
                                  <Dividend>
                                    <Add>
                                      <Dependency path="/eitcPhaseoutAmountLowerBound" />
                                      <Dependency path="/eitcCompletedPhaseoutAmount" />
                                    </Add>
                                  </Dividend>
                                  <Divisors>
                                    <Int>2</Int>
                                  </Divisors>
                                </Divide>
                              </LesserOf>
                            </Minuend>
                            <Subtrahends>
                              <Dependency path="/eitcPhaseOutThreshold" />
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Then>
                    </Case>
                  </Switch>
                </Subtrahends>
              </Subtract>
            </LesserOf>
          </Round>
        </GreaterOf>
      </Derived>
    </Fact>

    <Fact path="/earnedIncomePlusSpouseCombatPay">
      <Name>Earned income plus spouse combat pay</Name>
      <Derived>
        <Add>
          <Dependency module="formW2s" path="/MFJSpouseCombatPay" />
          <Dependency module="income" path="/employerIncomeSubtotal" />
        </Add>
      </Derived>
    </Fact>

    <Fact path="/eitcRoundedEarnedIncomeWithSecondaryCombatPay">
      <Name>Rounded earned income for EITC with an MFJ spouse's combat pay</Name>
      <Description>In order to match the EITC table from Publication 596, we must round the income to match the rows,
        which use increments of $50, calculating the amount of the credit for the midpoint of row (i.e. $25, $75, $125,
        etc.).</Description>
      <Derived>
        <Add>
          <StepwiseMultiply>
            <Multiplicand>
              <Dependency path="/earnedIncomePlusSpouseCombatPay" />
            </Multiplicand>
            <Rate>
              <Rational>50/50</Rational> <!-- $50 for every whole $50 of income -->
            </Rate>
          </StepwiseMultiply>
          <Dollar>25</Dollar> <!-- Add $25 to find the midpoint of the row -->
        </Add>
      </Derived>
    </Fact>

    <Fact path="/eitcAmountWithBothTPCombatPay">
      <Name>The amount of the Earned Income Tax Credit with secondary filer combat pay</Name>
      <Description>The amount of EITC, if the taxpayer is eligible. Magic numbers come from
        https://www.irs.gov/pub/irs-drop/rp-21-45.pdf and will need to be updated for 2023 with
        https://www.irs.gov/pub/irs-drop/rp-22-38.pdf</Description>

      <Derived>
        <GreaterOf> <!-- Cannot be less than zero -->
          <Dollar>0</Dollar>
          <Round>
            <LesserOf>
              <Dependency path="/maxEitcFromAGI" />
              <Subtract>
                <Minuend>
                  <Switch>
                    <!-- If the upper band of the row would exceed the max credit, use the max credit -->
                    <Case>
                      <When>
                        <GreaterThanOrEqual>
                          <Left>
                            <Multiply> <!-- Multiply earned income by the phase in rate -->
                              <Dependency path="/eitcPhaseInRate" />
                              <Add>
                                <Dependency path="/eitcRoundedEarnedIncomeWithBothTPCombatPay" />
                                <Dollar>24</Dollar>
                              </Add>
                            </Multiply>
                          </Left>
                          <Right>
                            <Dependency path="/eitcMaxCredit" />
                          </Right>
                        </GreaterThanOrEqual>
                      </When>
                      <Then>
                        <Dependency path="/eitcMaxCredit" />
                      </Then>
                    </Case>
                    <!-- Otherwise, use the normal calculation -->
                    <Case>
                      <When>
                        <True />
                      </When>
                      <Then>
                        <LesserOf> <!-- Cannot exceed the limit -->
                          <Dependency path="/eitcMaxCredit" />
                          <Multiply> <!-- Multiply earned income by the phase in rate -->
                            <Dependency path="/eitcPhaseInRate" />
                            <Dependency path="/eitcRoundedEarnedIncomeWithBothTPCombatPay" />
                          </Multiply>
                        </LesserOf>
                      </Then>
                    </Case>
                  </Switch>
                </Minuend>

                <Subtrahends>
                  <Switch>
                    <Case>
                      <!-- If the threshold is greater than the lower bound of the row, we don't apply any phaseout -->
                      <When>
                        <GreaterThan>
                          <Left>
                            <Add>
                              <Dependency path="/eitcPhaseOutThreshold" />
                              <Dollar>25</Dollar>
                            </Add>
                          </Left>
                          <Right>
                            <Dependency path="/eitcRoundedEarnedIncomeWithBothTPCombatPay" />
                          </Right>
                        </GreaterThan>
                      </When>
                      <Then>
                        <Dollar>0</Dollar>
                      </Then>
                    </Case>
                    <Case>
                      <When>
                        <True />
                      </When>
                      <Then>
                        <Multiply> <!-- Phaseout for income over the threshold -->
                          <Dependency path="/eitcPhaseOutRate" />
                          <Subtract>
                            <Minuend>
                              <LesserOf>
                                <!-- The midpoint of the row -->
                                <Dependency path="/eitcRoundedEarnedIncomeWithBothTPCombatPay" />
                                <!-- The midpoint of the lower bound of the row and the completed phaseout amount-->
                                <Divide>
                                  <Dividend>
                                    <Add>
                                      <Dependency path="/eitcPhaseoutAmountLowerBound" />
                                      <Dependency path="/eitcCompletedPhaseoutAmount" />
                                    </Add>
                                  </Dividend>
                                  <Divisors>
                                    <Int>2</Int>
                                  </Divisors>
                                </Divide>
                              </LesserOf>
                            </Minuend>
                            <Subtrahends>
                              <Dependency path="/eitcPhaseOutThreshold" />
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Then>
                    </Case>
                  </Switch>
                </Subtrahends>
              </Subtract>
            </LesserOf>
          </Round>
        </GreaterOf>
      </Derived>
    </Fact>

    <Fact path="/earnedIncomePlusBothTPCombatPay">
      <Name>Earned income plus primary and spouse combat pay</Name>
      <Derived>
        <Add>
          <Dependency module="formW2s" path="/primaryFilerCombatPay" />
          <Dependency module="formW2s" path="/MFJSpouseCombatPay" />
          <Dependency module="income" path="/employerIncomeSubtotal" />
        </Add>
      </Derived>
    </Fact>

    <Fact path="/eitcRoundedEarnedIncomeWithBothTPCombatPay">
      <Name>Rounded earned income for EITC with an MFJ spouse's combat pay</Name>
      <Description>In order to match the EITC table from Publication 596, we must round the income to match the rows,
        which use increments of $50, calculating the amount of the credit for the midpoint of row (i.e. $25, $75, $125,
        etc.).</Description>
      <Derived>
        <Add>
          <StepwiseMultiply>
            <Multiplicand>
              <Dependency path="/earnedIncomePlusBothTPCombatPay" />
            </Multiplicand>
            <Rate>
              <Rational>50/50</Rational> <!-- $50 for every whole $50 of income -->
            </Rate>
          </StepwiseMultiply>
          <Dollar>25</Dollar> <!-- Add $25 to find the midpoint of the row -->
        </Add>
      </Derived>
    </Fact>

    <Fact path="/eitcRoundedAGI">
      <Name>Rounded AGI for EITC</Name>
      <Description>In order to match the EITC table from Publication 596, we must round the income to match the rows,
        which use increments of $50, calculating the amount of the credit for the midpoint of row (i.e. $25, $75, $125,
        etc.).</Description>
      <Derived>
        <Add>
          <StepwiseMultiply>
            <Multiplicand>
              <Dependency module="taxCalculations" path="/agi" />
            </Multiplicand>
            <Rate>
              <Rational>50/50</Rational> <!-- $50 for every whole $50 of income -->
            </Rate>
          </StepwiseMultiply>
          <Dollar>25</Dollar> <!-- Add $25 to find the midpoint of the row -->
        </Add>
      </Derived>
    </Fact>

    <Fact path="/eitcMaxCredit">
      <Name>EITC maximum credit amount</Name>
      <Description>The maximum amount of EITC a taxpayer can recieve, depending on the number of qualifying children.</Description>

      <Derived>
        <Switch>
          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency module="familyAndHousehold" path="/numEitcDependentsCollectionForCalculation" />
                </Left>
                <Right>
                  <Int>0</Int>
                </Right>
              </Equal>
            </When>
            <Then>
              <Dependency path="/maxEitcWith0QualifyingChildren" />
            </Then>
          </Case>
          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency module="familyAndHousehold" path="/numEitcDependentsCollectionForCalculation" />
                </Left>
                <Right>
                  <Int>1</Int>
                </Right>
              </Equal>
            </When>
            <Then>
              <Dependency path="/maxEitcWith1QualifyingChild" />
            </Then>
          </Case>
          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency module="familyAndHousehold" path="/numEitcDependentsCollectionForCalculation" />
                </Left>
                <Right>
                  <Int>2</Int>
                </Right>
              </Equal>
            </When>
            <Then>
              <Dependency path="/maxEitcWith2QualifyingChildren" />
            </Then>
          </Case>
          <Case>
            <When>
              <GreaterThanOrEqual>
                <Left>
                  <Dependency module="familyAndHousehold" path="/numEitcDependentsCollectionForCalculation" />
                </Left>
                <Right>
                  <Int>3</Int>
                </Right>
              </GreaterThanOrEqual>
            </When>
            <Then>
              <Dependency path="/maxEitcWith3OrMoreQualifyingChildren" />
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/phaseInEndsFor0QualifyingChildren">
      <Name>Maximum phase in amount with 0 children</Name>
      <Description>The earned income amount which provides the max EITC with 0 qualifying children
        Rev Proc .06 Earned
        Income Credit ยง32(b)
      </Description>
      <TaxYear>2024</TaxYear>

      <Derived>
        <Dollar>8260</Dollar>
      </Derived>
    </Fact>

    <Fact path="/phaseInEndsFor1QualifyingChild">
      <Name>Maximum phase in amount with 1 child</Name>
      <Description>The earned income amount which provides the max EITC with 1 qualifying child
        Rev Proc .06 Earned
        Income Credit ยง32(b)
      </Description>
      <TaxYear>2024</TaxYear>

      <Derived>
        <Dollar>12390</Dollar>
      </Derived>
    </Fact>

    <Fact path="/phaseInEndsFor2OrMoreQualifyingChildren">
      <Name>Maximum phase in amount with 2 or more children</Name>
      <Description>The earned income amount which provides the max EITC with 2 or more qualifying children
        Rev Proc .06
        Earned Income Credit ยง32(b)
      </Description>
      <TaxYear>2024</TaxYear>

      <Derived>
        <Dollar>17400</Dollar>
      </Derived>
    </Fact>

    <Fact path="/maxEitcWith0QualifyingChildren">
      <Name>Maximum EITC amount with 0 children</Name>
      <Description>The maximum earned income tax credit with 0 qualifying children</Description>

      <Derived>
        <Round>
          <Multiply>
            <Dependency path="/phaseInRatesFor0Qc" />
            <Dependency path="/phaseInEndsFor0QualifyingChildren" />
          </Multiply>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/maxEitcWith1QualifyingChild">
      <Name>Maximum EITC amount with 1 child</Name>
      <Description>The maximum earned income tax credit with 1 qualifying child</Description>

      <Derived>
        <Round>
          <Multiply>
            <Dependency path="/phaseInRatesFor1Qc" />
            <Dependency path="/phaseInEndsFor1QualifyingChild" />
          </Multiply>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/maxEitcWith2QualifyingChildren">
      <Name>Maximum EITC amount with 2 children</Name>
      <Description>The maximum earned income tax credit with 2 qualifying children</Description>

      <Derived>
        <Round>
          <Multiply>
            <Dependency path="/phaseInRatesFor2Qc" />
            <Dependency path="/phaseInEndsFor2OrMoreQualifyingChildren" />
          </Multiply>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/maxEitcWith3OrMoreQualifyingChildren">
      <Name>Maximum EITC amount with 3 or more children</Name>
      <Description>The maximum earned income tax credit with 3 or more qualifying children</Description>

      <Derived>
        <Round>
          <Multiply>
            <Dependency path="/phaseInRatesFor3OrMoreQc" />
            <Dependency path="/phaseInEndsFor2OrMoreQualifyingChildren" />
          </Multiply>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/roundedMaxEitcWith0QualifyingChildren">
      <Name>Rounded maximum EITC amount with 0 children</Name>
      <Description>The rounded version of maxEitcWith0QualifyingChildren</Description>

      <Derived>
        <Round>
          <Dependency path="/maxEitcWith0QualifyingChildren" />
        </Round>
      </Derived>
    </Fact>

    <Fact path="/roundedMaxEitcWith1QualifyingChild">
      <Name>Rounded maximum EITC amount with 1 child</Name>
      <Description>The rounded version of maxEitcWith1QualifyingChild</Description>

      <Derived>
        <Round>
          <Dependency path="/maxEitcWith1QualifyingChild" />
        </Round>
      </Derived>
    </Fact>

    <Fact path="/roundedMaxEitcWith2QualifyingChildren">
      <Name>Rounded maximum EITC amount with 2 children</Name>
      <Description>The rounded version of maxEitcWith2QualifyingChildren</Description>

      <Derived>
        <Round>
          <Dependency path="/maxEitcWith2QualifyingChildren" />
        </Round>
      </Derived>
    </Fact>

    <Fact path="/roundedMaxEitcWith3OrMoreQualifyingChildren">
      <Name>Rounded maximum EITC amount with 3 ore more children</Name>
      <Description>The rounded version of maxEitcWith3OrMoreQualifyingChildren</Description>

      <Derived>
        <Round>
          <Dependency path="/maxEitcWith3OrMoreQualifyingChildren" />
        </Round>
      </Derived>
    </Fact>

    <Fact path="/phaseInRatesFor0Qc">
      <Name>Phase in rate for 0 qualifying children</Name>

      <Derived>
        <Rational>765/10000</Rational>
      </Derived>
    </Fact>

    <Fact path="/phaseInRatesFor1Qc">
      <Name>Phase in rate for 1 qualifying child</Name>

      <Derived>
        <Rational>34/100</Rational>
      </Derived>
    </Fact>

    <Fact path="/phaseInRatesFor2Qc">
      <Name>Phase in rate for 2 qualifying children</Name>

      <Derived>
        <Rational>40/100</Rational>
      </Derived>
    </Fact>

    <Fact path="/phaseInRatesFor3OrMoreQc">
      <Name>Phase in rate for 3 or more qualifying children</Name>

      <Derived>
        <Rational>45/100</Rational>
      </Derived>
    </Fact>

    <Fact path="/eitcPhaseInRate">
      <Name>EITC phase in rate</Name>
      <Description>The rate at which EITC phases in with income.</Description>

      <Derived>
        <Switch>
          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency module="familyAndHousehold" path="/numEitcDependentsCollectionForCalculation" />
                </Left>
                <Right>
                  <Int>0</Int>
                </Right>
              </Equal>
            </When>
            <Then>
              <Dependency path="/phaseInRatesFor0Qc" />
            </Then>
          </Case>
          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency module="familyAndHousehold" path="/numEitcDependentsCollectionForCalculation" />
                </Left>
                <Right>
                  <Int>1</Int>
                </Right>
              </Equal>
            </When>
            <Then>
              <Dependency path="/phaseInRatesFor1Qc" />
            </Then>
          </Case>
          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency module="familyAndHousehold" path="/numEitcDependentsCollectionForCalculation" />
                </Left>
                <Right>
                  <Int>2</Int>
                </Right>
              </Equal>
            </When>
            <Then>
              <Dependency path="/phaseInRatesFor2Qc" />
            </Then>
          </Case>
          <Case>
            <When>
              <GreaterThanOrEqual>
                <Left>
                  <Dependency module="familyAndHousehold" path="/numEitcDependentsCollectionForCalculation" />
                </Left>
                <Right>
                  <Int>3</Int>
                </Right>
              </GreaterThanOrEqual>
            </When>
            <Then>
              <Dependency path="/phaseInRatesFor3OrMoreQc" />
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/eitcPhaseOutRate">
      <Name>EITC phase out rate</Name>
      <Description>The rate at which EITC phases out as income exceeds the threshold amount.</Description>

      <Derived>
        <Switch>
          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency module="familyAndHousehold" path="/numEitcDependentsCollectionForCalculation" />
                </Left>
                <Right>
                  <Int>0</Int>
                </Right>
              </Equal>
            </When>
            <Then>
              <Rational>765/10000</Rational>
            </Then>
          </Case>
          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency module="familyAndHousehold" path="/numEitcDependentsCollectionForCalculation" />
                </Left>
                <Right>
                  <Int>1</Int>
                </Right>
              </Equal>
            </When>
            <Then>
              <Rational>1598/10000</Rational>
            </Then>
          </Case>
          <Case>
            <When>
              <GreaterThanOrEqual>
                <Left>
                  <Dependency module="familyAndHousehold" path="/numEitcDependentsCollectionForCalculation" />
                </Left>
                <Right>
                  <Int>2</Int>
                </Right>
              </GreaterThanOrEqual>
            </When>
            <Then>
              <Rational>2106/10000</Rational>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/eitcPhaseOutThreshold">
      <Name>EITC phaseout amount threshold</Name>
      <Description>The amount of income above which the amount of EITC begins to be reduced.
        Rev Proc .06 Earned Income
        Credit ยง32(b)
      </Description>
      <TaxYear>2024</TaxYear>

      <Derived>
        <Switch>
          <Case>
            <When>
              <Any>
                <Dependency module="filingStatus" path="/isFilingStatusSingle" />
                <Dependency module="filingStatus" path="/isFilingStatusHOH" />
                <Dependency module="filingStatus" path="/isFilingStatusQSS" />
                <Dependency module="filingStatus" path="/isFilingStatusMFS" />
              </Any>
            </When>
            <Then>
              <Switch>
                <Case>
                  <When>
                    <Equal>
                      <Left>
                        <Dependency module="familyAndHousehold"
                          path="/numEitcDependentsCollectionForCalculation" />
                      </Left>
                      <Right>
                        <Int>0</Int>
                      </Right>
                    </Equal>
                  </When>
                  <Then>
                    <Dollar>10330</Dollar>
                  </Then>
                </Case>
                <Case>
                  <When>
                    <GreaterThanOrEqual>
                      <Left>
                        <Dependency module="familyAndHousehold"
                          path="/numEitcDependentsCollectionForCalculation" />
                      </Left>
                      <Right>
                        <Int>1</Int>
                      </Right>
                    </GreaterThanOrEqual>
                  </When>
                  <Then>
                    <Dollar>22720</Dollar>
                  </Then>
                </Case>
              </Switch>
            </Then>
          </Case>
          <Case>
            <When>
              <Dependency module="filingStatus" path="/isFilingStatusMFJ" />
            </When>
            <Then>
              <Switch>
                <Case>
                  <When>
                    <Equal>
                      <Left>
                        <Dependency module="familyAndHousehold"
                          path="/numEitcDependentsCollectionForCalculation" />
                      </Left>
                      <Right>
                        <Int>0</Int>
                      </Right>
                    </Equal>
                  </When>
                  <Then>
                    <Dollar>17250</Dollar>
                  </Then>
                </Case>
                <Case>
                  <When>
                    <GreaterThanOrEqual>
                      <Left>
                        <Dependency module="familyAndHousehold"
                          path="/numEitcDependentsCollectionForCalculation" />
                      </Left>
                      <Right>
                        <Int>1</Int>
                      </Right>
                    </GreaterThanOrEqual>
                  </When>
                  <Then>
                    <Dollar>29640</Dollar>
                  </Then>
                </Case>
              </Switch>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/belowEitcInvestmentIncomeLimit">
      <Name>Below EITC Investment Income Limit</Name>
      <Description>Whether the TP's Investment Income is low enough for the EITC
        Rev Proc .06 Earned Income Credit ยง32(i)
      </Description>
      <TaxYear>2024</TaxYear>

      <Derived>
        <LessThanOrEqual>
          <Left>
            <!-- The investment income from lines 2a, 2b, 3b, and 7 per 1040 instructions -->
            <Add>
              <Dependency module="interest" path="/taxExemptInterest" />
              <Dependency module="interest" path="/interestIncome" />
              <Dependency module="income" path="/ordinaryDividends" />
              <GreaterOf>
                <Dependency module="income" path="/capitalGainsOrLosses" />
                <Dollar>0</Dollar>
              </GreaterOf>
            </Add>
          </Left>
          <Right>
            <!-- Limit for 2024 -->
            <Dollar>11600</Dollar>
          </Right>
        </LessThanOrEqual>
      </Derived>
    </Fact>

    <Fact path="/eitcQcOfAnother">
      <Name>EITC QC Of Another</Name>
      <Description>Whether the TP or their spouse, if applicable, could be someone else's QC for EITC</Description>

      <Writable>
        <Boolean />
      </Writable>
    </Fact>

    <Fact path="/eitcQcOfAnotherRequiredToFile">
      <Name>EITC QC Of Another Required to file</Name>
      <Description>Whether the person who can claim TP or SP as a QC for EITC is required tofile</Description>

      <Writable>
        <Boolean />
      </Writable>
    </Fact>

    <Fact path="/eitcQcOfAnotherIsFiling">
      <Name>EITC QC Of Another is filing</Name>
      <Description>Whether the person who can claim TP or SP as a QC for EITC is filing</Description>

      <Writable>
        <Boolean />
      </Writable>
    </Fact>

    <Fact path="/eitcQcOfAnotherIsFilingRefundOnly">
      <Name>EITC QC Of Another is filing</Name>
      <Description>Whether the person who can claim TP or SP as a QC for EITC is filing for a refund only</Description>

      <Writable>
        <Boolean />
      </Writable>
    </Fact>

    <Fact path="/flowShowNotEitcQc">
      <Name>Flow whether to show eitc qc summary</Name>
      <Description>Whether to show that the TP is eligible for EITC despite being QC of another.</Description>

      <Derived>
        <All>
          <Dependency path="/eitcQcTest" />
          <Dependency path="/eitcQcOfAnother" />
        </All>
      </Derived>
    </Fact>

    <Fact path="/eitcQcTest">
      <Name>EITC QC Test</Name>
      <Description>Whether the TP qualifies for EITC when accounting for the possibility that they could be the QC of
        another TP.</Description>

      <Derived>
        <Any>
          <Not>
            <!-- TP is not QC of another -->
            <Dependency path="/eitcQcOfAnother" />
          </Not>
          <!-- TP QC of another and they are not required to file -->
          <All>
            <Dependency path="/eitcQcOfAnother" />
            <Not>
              <Dependency path="/eitcQcOfAnotherRequiredToFile" />
            </Not>
            <Any>
              <!-- and they choose not to file, so TP is not a QC -->
              <Not>
                <Dependency path="/eitcQcOfAnotherIsFiling" />
              </Not>
              <!-- or they file for refund only, so TP is not a QC -->
              <All>
                <Dependency path="/eitcQcOfAnotherIsFiling" />
                <Dependency path="/eitcQcOfAnotherIsFilingRefundOnly" />
              </All>
            </Any>
          </All>
        </Any>
      </Derived>
    </Fact>

    <Fact path="/failsEitcQcTest">
      <Name>Fails EITC QC Test</Name>
      <Description>Whether the TP does not qualify for EITC when accounting for the possibility that they could be the
        QC of another TP. Used in Schedule 8862 to answer Part II line 4</Description>
      <Export mef="true" />

      <Derived>
        <Not>
          <Dependency path="/eitcQcTest" />
        </Not>
      </Derived>
    </Fact>

    <Fact path="/pdf8862Line4Yes">
      <Name>Form 8862 Line 4 Yes checkbox</Name>
      <Description>Whether the PDF checkbox should be checked.</Description>

      <Derived>
        <All>
          <Dependency path="/failsEitcQcTest" />
          <Dependency path="/eitc8862Required" />
        </All>
      </Derived>
    </Fact>

    <Fact path="/pdf8862Line4No">
      <Name>Form 8862 Line 4 No checkbox</Name>
      <Description>Whether the PDF checkbox should be checked.</Description>

      <Derived>
        <All>
          <Dependency path="/eitcQcTest" />
          <Dependency path="/eitc8862Required" />
        </All>
      </Derived>
    </Fact>

    <Fact path="/eitcHadImproperClaims">
      <Name>EITC Had Improper Claims</Name>
      <Description>Whether the TP (or their spouse, if applicable) has had their EITC reduced or disallowed for any
        reason other than a math error.</Description>

      <Writable>
        <Boolean />
      </Writable>
    </Fact>

    <Fact path="/eitcImproperClaimsDueToQc">
      <Name>EITC Improper Claims Due to QC</Name>
      <Description>Whether the EITC was reduced or disallowed due to a child not being qualifying</Description>

      <Writable>
        <Boolean />
      </Writable>
    </Fact>


    <Fact path="/eitcImproperClaimTakenSinceDisallowal">
      <Name>EITC Had Improper Claims</Name>
      <Description>Whether the TP (or their spouse, if applicable) has taken the EITC again since they were disallowed</Description>

      <Writable>
        <Boolean />
      </Writable>
    </Fact>

    <Fact path="/eitcReceivedImproperClaimsNotice">
      <Name>Received Eitc improper Claims notice</Name>
      <Description>Whether the TP received a letter from the IRS telling them they're not allowed to take EITC for a
        number of years</Description>
      <Writable>
        <Enum optionsPath="/improperClaimsNoticeOptions" />
      </Writable>
    </Fact>

    <Fact path="/eitcNoticeTest">
      <Name>EITC Notice Test</Name>
      <Description>Whether the TP is qualified for the EITC w.r.t having received an improper claims notice in the past</Description>

      <Derived>
        <Any>
          <Not>
            <!-- has not received a notice about improper claims -->
            <Dependency path="/eitcHadImproperClaims" />
          </Not>
          <!-- Received a notice but it was due to claiming QCs -->
          <All>
            <Dependency path="/hasImproperClaimsAndNoQc" />
            <Dependency path="/eitcImproperClaimsDueToQc" />
          </All>
          <!-- Received a notice but has taken it again since then-->
          <All>
            <Dependency path="/flowHasImproperClaimsAndAskAboutLastClaimedCredit" />
            <Dependency path="/eitcImproperClaimTakenSinceDisallowal" />
          </All>
          <!-- Received a notice but has taken it did not contain a ban for a certain number of
            years -->
          <All>
            <Dependency path="/eitcHadImproperClaims" />
            <Equal>
              <Left>
                <Dependency path="/eitcReceivedImproperClaimsNotice" />
              </Left>
              <Right>
                <Enum optionsPath="/improperClaimsNoticeOptions">zeroYears</Enum>
              </Right>
            </Equal>
          </All>
          <!-- Received a notice but it has expired -->
          <All>
            <Dependency path="/eitcHadImproperClaims" />
            <Dependency path="/eitcImproperClaimsNoticeExpired" />
          </All>
        </Any>
      </Derived>
    </Fact>

    <Fact path="/eitc8862Required">
      <Name>EITC 8862 Required</Name>
      <Description>Whether the TP is required to file form 8862 to receive the EITC Part V is currently out of scope.</Description>
      <Export downstreamFacts="true" mef="true" />

      <Derived>
        <All>
          <!-- has received a notice about improper claims also checks if notice was not just due to incorrectly
          claiming a QC if applicable-->
          <Dependency path="/flowHasImproperClaimsAndAskAboutLastClaimedCredit" />
          <!-- and the TP has not taken the credit again yet-->
          <Not>
            <Dependency path="/eitcImproperClaimTakenSinceDisallowal" />
          </Not>
          <Any>
            <!-- and they were not banned for a number of years -->
            <Equal>
              <Left>
                <Dependency path="/eitcReceivedImproperClaimsNotice" />
              </Left>
              <Right>
                <Enum optionsPath="/improperClaimsNoticeOptions">zeroYears</Enum>
              </Right>
            </Equal>
            <!-- Or that ban has expired-->
            <All>
              <IsComplete>
                <Dependency path="/eitcReceivedImproperClaimsNotice" />
              </IsComplete>
              <Dependency path="/eitcImproperClaimsNoticeExpired" />
            </All>
          </Any>
          <Dependency path="/isReceivingEitc" />
        </All>
      </Derived>
    </Fact>

    <Fact path="/form8862RequiredAndHasQualifyingChildren">
      <Name>Form 8862 required and has EITC qualifying children</Name>
      <Description>Form 8862 is required and TP has EITC qualifying children</Description>
      <Export downstreamFacts="true" mef="true" />

      <Derived>
        <All>
          <Dependency module="eitc" path="/eitc8862Required" />
          <Dependency path="/maybeEligibleForEitcWithQc" />
        </All>
      </Derived>
    </Fact>

    <Fact path="/form8862RequiredAndHasNoQualifyingChildren">
      <Name>Form 8862 required and has no EITC qualifying children</Name>
      <Description>Form 8862 is required and TP does not have EITC qualifying children</Description>
      <Export downstreamFacts="true" mef="true" />

      <Derived>
        <All>
          <Dependency path="/eitc8862Required" />
          <Equal>
            <Left>
              <Dependency module="familyAndHousehold" path="/numEitcQualifyingChildren" />
            </Left>
            <Right>
              <Int>0</Int>
            </Right>
          </Equal>
        </All>
      </Derived>
    </Fact>

    <Fact path="/form8862RequiredAndHasNoQualifyingChildrenAndIsFilingMFJ">
      <Name>Form 8862 required and has no EITC qualifying children</Name>
      <Description>Form 8862 is required and TP does not have EITC qualifying children</Description>
      <Export mef="true" />

      <Derived>
        <All>
          <Dependency path="/form8862RequiredAndHasNoQualifyingChildren" />
          <Dependency module="filingStatus" path="/isFilingStatusMFJ" />
        </All>
      </Derived>
    </Fact>

    <Fact path="/pdfIncludeForm8862">
      <Name>PDF should include Form 8862</Name>
      <Description>Whether the tax return PDF should include Form 8862, Information To CLaim Certain Credits After
        Disallowance.</Description>

      <Derived>
        <Any>
          <Dependency path="/eitc8862Required" />
          <Dependency module="ctcOdc" path="/ctc8862Required" />
        </Any>
      </Derived>
    </Fact>

    <Fact path="/eitcQualified">
      <Name>Whether the TP is eligible for the EITC</Name>
      <Description>Whether the TP passes various tests to be eligible for the Earned Income Tax Credit (EITC) in
        finality, after the EITC sections of the flow</Description>
      <Export downstreamFacts="true" />

      <Derived>
        <All>
          <Dependency path="/maybeEligibleForEitc" />
          <Dependency path="/eitcQcTest" />
          <Dependency path="/eitcNoticeTest" />
        </All>
      </Derived>
    </Fact>

    <Fact path="/maybeEligibleForEitc">
      <Name>Whether the TP may be eligible for the EITC</Name>
      <Description>Whether the TP passes various tests to be eligible for the Earned Income Tax Credit (EITC) prior to
        the EITC section of the flow. After this, we still need to test
        1. If the TP is the QC of another TP
        2. If they
        have been disqualified from taking EITC by the IRS</Description>
      <Export downstreamFacts="true" />

      <Derived>
        <All>
          <Dependency path="/maybeEligibleForEitcBase" />
          <Not>
            <Dependency path="/noEitcDueToSeparateFilingFromSpouse" />
          </Not>
          <Any>
            <Dependency path="/maybeEligibleForEitcWithQc" />
            <Dependency path="/maybeEligibleForEitcWithoutQc" />
          </Any>
        </All>
      </Derived>
    </Fact>

    <Fact path="/maybeEligibleForEitcWithQc">
      <Name>Whether the TP may be eligible for the EITC</Name>
      <Description>Whether the TP passes various tests to be eligible for the Earned Income Tax Credit (EITC)</Description>

      <Derived>
        <All>
          <GreaterThan>
            <Left>
              <Dependency module="familyAndHousehold" path="/numEitcQualifyingChildren" />
            </Left>
            <Right>
              <Int>0</Int>
            </Right>
          </GreaterThan>
        </All>
      </Derived>
    </Fact>

    <Fact path="/noEitcDueToSeparateFilingFromSpouse">
      <Description>
        Used for display in the flow. The TP doesn't have EITC because they are filing separately from their
        spouse (either MFS or HOH) and have no qualifying children or they did not meet the special rule for spearated
        spouses
      </Description>

      <Derived>
        <All>
          <!-- If we don't have the information we need, don't rule out EITC yet -->
          <IsComplete>
            <Dependency path="/filingStatus" module="filingStatus" />
          </IsComplete>
          <IsComplete>
            <Dependency path="/specialRuleForSeparatedSpouses" module="filers" />
          </IsComplete>

          <!-- They are married and not filing jointly-->
          <Dependency module="filers" path="/isMarried" />
          <Not>
            <Dependency module="filingStatus" path="/isFilingStatusMFJ" />
          </Not>
          <Any>
            <!-- and either they did not meet the special rule for separated spouses -->
            <Not>
              <Dependency module="filers" path="/specialRuleForSeparatedSpouses" />
            </Not>
            <!-- or they did not have any qualifying children -->
            <Equal>
              <Left>
                <Dependency module="familyAndHousehold" path="/numEitcQualifyingChildren" />
              </Left>
              <Right>
                <Int>0</Int>
              </Right>
            </Equal>
          </Any>
        </All>
      </Derived>
    </Fact>

    <Fact path="/maybeEligibleForEitcWithoutQc">
      <Name>Whether the TP may be eligible for the EITC</Name>
      <Description>Whether the TP passes various tests to be eligible for the Earned Income Tax Credit (EITC)</Description>

      <Derived>
        <All>
          <!-- Due to scope, every TP and their spouse at this point has been a full year US
            resident so we do not worry about that req. -->
          <Equal>
            <Left>
              <Dependency module="familyAndHousehold" path="/numEitcQualifyingChildren" />
            </Left>
            <Right>
              <Int>0</Int>
            </Right>
          </Equal>
          <Any>
            <!-- Married filers must file jointly. They cannot file as MFS or as HOH
                 and receive EITC without having QCs -->
            <Dependency module="filingStatus" path="/isFilingStatusMFJ" />
            <Not>
              <Dependency module="filers" path="/isMarried" />
            </Not>
          </Any>
          <!-- The filer cannot be claimed as a dependent -->
          <Not>
            <Dependency module="filers" path="/treatFilersAsDependents" />
          </Not>
          <Dependency path="/filersAgeTestForEitcWithNoQC" />
        </All>
      </Derived>
    </Fact>

    <Fact path="/hasImproperClaimsAndNoQc">
      <Name>Has improper claims and no qc</Name>
      <Description>Whether the TP has had improper EITC claims and has no qualifying children</Description>

      <Derived>
        <All>
          <Dependency path="/eitcHadImproperClaims" />
          <Dependency path="/hasZeroEitcQualifyingChildren" />
        </All>
      </Derived>
    </Fact>

    <Fact path="/flowHasImproperClaimsAndAskAboutLastClaimedCredit">
      <Name>Show EITC credits taken since disallowal question</Name>
      <Description>Checks whether the TP has taken improper claims and has qualifying children to determine if they
        should be asked about the last time they have taken the earned income tax credit</Description>
      <Derived>
        <Any>
          <All>
            <Dependency path="/hasImproperClaimsAndNoQc" />
            <Not>
              <Dependency path="/eitcImproperClaimsDueToQc" />
            </Not>
          </All>
          <All>
            <Dependency path="/eitcHadImproperClaims" />
            <Dependency path="/maybeEligibleForEitcWithQc" />
          </All>
        </Any>
      </Derived>
    </Fact>

    <Fact path="/filersAgeTestForEitcWithNoQC">
      <Name>TP(s) age test for EITC with no QC</Name>
      <Description>TP(s) age test for EITC with no qualifying children</Description>

      <Derived>
        <Switch>
          <Case>
            <!-- if MFJ, you and your spouse must meet these requirements -->
            <When>
              <Dependency module="filingStatus" path="/isFilingStatusMFJ" />
            </When>
            <Then>
              <All>
                <Any>
                  <!-- You or your spouse must be greater than or equal to 25 but less than 65 at
                    the end of the tax year -->
                  <All>
                    <Dependency module="filers" path="/primaryFiler/age25OrOlderForEitc" />
                    <Dependency module="filers" path="/primaryFiler/age64OrYoungerForEitc" />
                  </All>
                  <All>
                    <Dependency module="filers" path="/secondaryFiler/age25OrOlderForEitc" />
                    <Dependency module="filers" path="/secondaryFiler/age64OrYoungerForEitc" />
                  </All>
                </Any>
              </All>
            </Then>
          </Case>
          <Case>
            <!-- if not MFJ, only you -->
            <When>
              <True />
            </When>
            <Then>
              <!-- You must be greater than or equal to 25 but less than 65 at the
                end of the tax year -->
              <All>
                <Dependency module="filers" path="/primaryFiler/age25OrOlderForEitc" />
                <Dependency module="filers" path="/primaryFiler/age64OrYoungerForEitc" />
              </All>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/maybeEligibleForEitcBase">
      <Name>Whether the TP may be eligible for the EITC Base</Name>
      <Description>Base rules that define whhether the TP passes various tests to be eligible for the Earned Income Tax
        Credit (EITC) before running child-specific tests</Description>

      <Derived>
        <All>
          <!-- When we support Form 2555, Foreign Earned Income, we'll need to disqualify
            people here -->
          <Dependency path="/hasEarnedIncome" />
          <Dependency path="/belowEitcEarnedIncomeLimit" />
          <Dependency path="/belowEitcAgiLimit" />
          <Dependency path="/belowEitcInvestmentIncomeLimit" />
          <Dependency module="filers" path="/filersCouldQualifyForEitc" />
        </All>
      </Derived>
    </Fact>

    <Fact path="/hasZeroEitcQualifyingChildren">
      <Name>Has zero EITC Qualifying Children</Name>
      <Description>Whether the TP(s) has zero EITC qualifying children</Description>

      <Derived>
        <Equal>
          <Left>
            <Dependency module="familyAndHousehold" path="/numEitcQualifyingChildren" />
          </Left>
          <Right>
            <Int>0</Int>
          </Right>
        </Equal>
      </Derived>
    </Fact>

    <Fact path="/eitcQCsNeedAdditionalInfo">
      <Name>Whether the unclaimed and/or deceased EITC QCs need more information.</Name>
      <Description>Whether the TP has unclaimed and/or deceased EITC QCs.</Description>
      <Derived>
        <GreaterThan>
          <Left>
            <Add>
              <CollectionSize>
                <Dependency module="familyAndHousehold" path="/unclaimedEITCQcsCollection" />
              </CollectionSize>
              <CollectionSize>
                <Dependency module="familyAndHousehold" path="/deceasedEitcEligibleQcCollection" />
              </CollectionSize>
            </Add>
          </Left>
          <Right>
            <Int>0</Int>
          </Right>
        </GreaterThan>
      </Derived>
    </Fact>

    <Fact path="/hasMoreThanZeroEitcQualifyingChildren">
      <Name>Number of EITC Qualifying Children is greater than zero.</Name>
      <Description>The number of dependents who qualify as QCs for EITC is greater than zero.</Description>

      <Derived>
        <GreaterThan>
          <Left>
            <Count>
              <Dependency module="familyAndHousehold" path="/familyAndHousehold/*/eitcQualifyingChild" />
            </Count>
          </Left>
          <Right>
            <Int>0</Int>
          </Right>
        </GreaterThan>
      </Derived>
    </Fact>


    <Fact path="/hasEarnedIncome">
      <Name>Has Earned Income</Name>
      <Description>Whether the TP had earned income</Description>

      <Derived>
        <GreaterThan>
          <Left>
            <Dependency module="income" path="/earnedIncomeWithAllCombatPay" />
          </Left>
          <Right>
            <Dollar>0</Dollar>
          </Right>
        </GreaterThan>
      </Derived>
    </Fact>

    <Fact path="/eitcMfjLimitWithThreeOrMoreChildren">
      <Name>EITC (MFJ) limit with 3 or more children</Name>
      <Description>EITC limit with 3 or more children when filing as MFJ
        Rev Proc .06 Earned Income Credit ยง32(b)
      </Description>
      <TaxYear>2024</TaxYear>
      <Derived>
        <Dollar>66819</Dollar>
      </Derived>
    </Fact>

    <Fact path="/eitcSelfLimitWithThreeOrMoreChildren">
      <Name>EITC (self) limit with 3 or more children</Name>
      <Description>EITC limit with 3 or more children when not filing as MFJ
        Rev Proc .06 Earned Income Credit ยง32(b)
      </Description>
      <TaxYear>2024</TaxYear>
      <Derived>
        <Dollar>59899</Dollar>
      </Derived>
    </Fact>

    <Fact path="/eitcMfjLimitWithTwoChildren">
      <Name>EITC (MFJ) limit with 2 children</Name>
      <Description>EITC limit with 2 children when filing as MFJ
        Rev Proc .06 Earned Income Credit ยง32(b)
      </Description>
      <TaxYear>2024</TaxYear>
      <Derived>
        <Dollar>62688</Dollar>
      </Derived>
    </Fact>

    <Fact path="/eitcSelfLimitWithTwoChildren">
      <Name>EITC (self) limit with 2 children</Name>
      <Description>EITC limit with 2 children when not filing as MFJ
        Rev Proc .06 Earned Income Credit ยง32(b)
      </Description>
      <TaxYear>2024</TaxYear>
      <Derived>
        <Dollar>55768</Dollar>
      </Derived>
    </Fact>

    <Fact path="/eitcMfjLimitWithOneChild">
      <Name>EITC (MFJ) limit with 1 child</Name>
      <Description>EITC limit with 1 child when filing as MFJ
        Rev Proc .06 Earned Income Credit ยง32(b)
      </Description>
      <TaxYear>2024</TaxYear>
      <Derived>
        <Dollar>56004</Dollar>
      </Derived>
    </Fact>

    <Fact path="/eitcSelfLimitWithOneChild">
      <Name>EITC (self) limit with 1 child</Name>
      <Description>EITC limit with 1 child when not filing as MFJ
        Rev Proc .06 Earned Income Credit ยง32(b)
      </Description>
      <TaxYear>2024</TaxYear>
      <Derived>
        <Dollar>49084</Dollar>
      </Derived>
    </Fact>

    <Fact path="/eitcMfjLimitWithZeroChildren">
      <Name>EITC (MFJ) limit with 0 children</Name>
      <Description>EITC limit with 0 children when filing as MFJ
        Rev Proc .06 Earned Income Credit ยง32(b)
      </Description>
      <TaxYear>2024</TaxYear>
      <Derived>
        <Dollar>25511</Dollar>
      </Derived>
    </Fact>

    <Fact path="/eitcSelfLimitWithZeroChildren">
      <Name>EITC (self) limit with 0 children</Name>
      <Description>EITC limit with 0 children when not filing as MFJ
        Rev Proc .06 Earned Income Credit ยง32(b)
      </Description>
      <TaxYear>2024</TaxYear>
      <Derived>
        <Dollar>18591</Dollar>
      </Derived>
    </Fact>

    <Fact path="/eitcCompletedPhaseoutAmount">
      <Name>EITC Completed Phaseout Amount</Name>
      <Description>The amount of income at which EITC is completely phased out.</Description>

      <Derived>
        <Switch>
          <!-- MFJ Limits -->
          <Case>
            <When>
              <Dependency module="filingStatus" path="/isFilingStatusMFJ" />
            </When>
            <Then>
              <Switch>
                <Case>
                  <When>
                    <GreaterThanOrEqual>
                      <Left>
                        <Dependency module="familyAndHousehold"
                          path="/numEitcDependentsCollectionForCalculation" />
                      </Left>
                      <Right>
                        <Int>3</Int>
                      </Right>
                    </GreaterThanOrEqual>
                  </When>
                  <Then>
                    <Dependency path="/eitcMfjLimitWithThreeOrMoreChildren" />
                  </Then>
                </Case>
                <Case>
                  <When>
                    <Equal>
                      <Left>
                        <Dependency module="familyAndHousehold"
                          path="/numEitcDependentsCollectionForCalculation" />
                      </Left>
                      <Right>
                        <Int>2</Int>
                      </Right>
                    </Equal>
                  </When>
                  <Then>
                    <Dependency path="/eitcMfjLimitWithTwoChildren" />
                  </Then>
                </Case>
                <Case>
                  <When>
                    <Equal>
                      <Left>
                        <Dependency module="familyAndHousehold"
                          path="/numEitcDependentsCollectionForCalculation" />
                      </Left>
                      <Right>
                        <Int>1</Int>
                      </Right>
                    </Equal>
                  </When>
                  <Then>
                    <Dependency path="/eitcMfjLimitWithOneChild" />
                  </Then>
                </Case>
                <Case>
                  <When>
                    <Equal>
                      <Left>
                        <Dependency module="familyAndHousehold"
                          path="/numEitcDependentsCollectionForCalculation" />
                      </Left>
                      <Right>
                        <Int>0</Int>
                      </Right>
                    </Equal>
                  </When>
                  <Then>
                    <Dependency path="/eitcMfjLimitWithZeroChildren" />
                  </Then>
                </Case>
              </Switch>
            </Then>
          </Case>
          <!-- Not MFJ Limits -->
          <Case>
            <When>
              <True />
            </When>
            <Then>
              <Switch>
                <Case>
                  <When>
                    <GreaterThanOrEqual>
                      <Left>
                        <Dependency module="familyAndHousehold"
                          path="/numEitcDependentsCollectionForCalculation" />
                      </Left>
                      <Right>
                        <Int>3</Int>
                      </Right>
                    </GreaterThanOrEqual>
                  </When>
                  <Then>
                    <Dependency path="/eitcSelfLimitWithThreeOrMoreChildren" />
                  </Then>
                </Case>
                <Case>
                  <When>
                    <Equal>
                      <Left>
                        <Dependency module="familyAndHousehold"
                          path="/numEitcDependentsCollectionForCalculation" />
                      </Left>
                      <Right>
                        <Int>2</Int>
                      </Right>
                    </Equal>
                  </When>
                  <Then>
                    <Dependency path="/eitcSelfLimitWithTwoChildren" />
                  </Then>
                </Case>
                <Case>
                  <When>
                    <Equal>
                      <Left>
                        <Dependency module="familyAndHousehold"
                          path="/numEitcDependentsCollectionForCalculation" />
                      </Left>
                      <Right>
                        <Int>1</Int>
                      </Right>
                    </Equal>
                  </When>
                  <Then>
                    <Dependency path="/eitcSelfLimitWithOneChild" />
                  </Then>
                </Case>
                <Case>
                  <When>
                    <Equal>
                      <Left>
                        <Dependency module="familyAndHousehold"
                          path="/numEitcDependentsCollectionForCalculation" />
                      </Left>
                      <Right>
                        <Int>0</Int>
                      </Right>
                    </Equal>
                  </When>
                  <Then>
                    <Dependency path="/eitcSelfLimitWithZeroChildren" />
                  </Then>
                </Case>
              </Switch>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/eitcPhaseoutAmountLowerBound">
      <Name>Lower bound phase-out amount</Name>
      <Description>The lower bound of the midpoint range that is associated with the complete phase-out amount</Description>

      <Derived>
        <StepwiseMultiply>
          <Multiplicand>
            <Dependency path="/eitcCompletedPhaseoutAmount" />
          </Multiplicand>
          <Rate>
            <Rational>50/50</Rational> <!-- rounds down to the nearest $50 -->
          </Rate>
        </StepwiseMultiply>
      </Derived>
    </Fact>

    <Fact path="/belowEitcEarnedIncomeLimit">
      <Name>Below EITC Earned Income Limit</Name>
      <Description>Whether the TP's Earned Income is low enough for the EITC. We always test this without combat pay,
        since it will be the lesser of the two amounts. Later, we have to calculate if combat pay is more or less
        advantageous.</Description>

      <Derived>
        <LessThan>
          <Left>
            <Dependency module="income" path="/employerIncomeSubtotal" />
          </Left>
          <Right>
            <Dependency path="/eitcCompletedPhaseoutAmount" />
          </Right>
        </LessThan>
      </Derived>
    </Fact>

    <Fact path="/belowEitcAgiLimit">
      <Name>Below EITC AGI Limit</Name>
      <Description>Whether the TP's AGI is low enough for the EITC</Description>

      <Derived>
        <LessThan>
          <Left>
            <Dependency module="taxCalculations" path="/agi" />
          </Left>
          <Right>
            <Dependency path="/eitcCompletedPhaseoutAmount" />
          </Right>
        </LessThan>
      </Derived>
    </Fact>

    <Fact path="/hadEitcImproperClaimsBan">
      <Name>EITC had an improper claims ban</Name>
      <Description>Whether the flow should ask a person if their CTC improper claims notice has expired</Description>
      <Derived>
        <All>
          <Not>
            <Dependency path="/eitcImproperClaimTakenSinceDisallowal" />
          </Not>
          <Any>
            <Equal>
              <Left>
                <Dependency path="/eitcReceivedImproperClaimsNotice" />
              </Left>
              <Right>
                <Enum optionsPath="/improperClaimsNoticeOptions">twoYears</Enum>
              </Right>
            </Equal>
            <Equal>
              <Left>
                <Dependency path="/eitcReceivedImproperClaimsNotice" />
              </Left>
              <Right>
                <Enum optionsPath="/improperClaimsNoticeOptions">tenYears</Enum>
              </Right>
            </Equal>
          </Any>
        </All>
      </Derived>
    </Fact>

    <Fact path="/eitcImproperClaimsNoticeExpired">
      <Name>EITC Improper Claims Notice Expired</Name>
      <Description>Whether the improper claims notice that the TP previously received is far enough in the past to be
        expired. E.g. They could not file for 2 years, and it has been at least 2 years</Description>

      <Writable>
        <Boolean />
      </Writable>
    </Fact>

    <Fact path="/pdfIncludeScheduleEic">
      <Name>PDF should include Schedule EIC</Name>
      <Description>Whether the tax return PDF should include Schedule EIC.</Description>

      <Derived>
        <All>
          <NotEqual>
            <Left>
              <Dependency path="/earnedIncomeCredit" />
            </Left>
            <Right>
              <Dollar>0</Dollar>
            </Right>
          </NotEqual>
          <GreaterThan>
            <Left>
              <Dependency module="familyAndHousehold" path="/numEitcQualifyingChildren" />
            </Left>
            <Right>
              <Int>0</Int>
            </Right>
          </GreaterThan>
        </All>
      </Derived>
    </Fact>

    <Fact path="/receivingEitcWhileSeparatedCheckbox">
      <Description>
        The TP is receiving EITC while they are married and filing separately from their sposue (either HOH
        or MFS)
        and there is a checkbox we must set in the pdf, and a field to send to MeF.
      </Description>
      <Export mef="true" />

      <Derived>
        <All>
          <Dependency module="filers" path="/isMarried" />
          <Not>
            <Dependency module="filingStatus" path="/isFilingStatusMFJ" />
          </Not>
          <Dependency path="/isReceivingEitc" />
        </All>
      </Derived>
    </Fact>

    <Fact path="/isEITCAmountWithPrimaryCombatPayGreaterThanWithoutCombatPay">
      <Name>Is the EITC amount with Primary combat pay greater than without combat pay</Name>
      <Description>Whether or not the EITC amount with Primary combat pay is greater then without combat pay</Description>

      <Derived>
        <All>
          <Dependency module="formW2s" path="/onlyPrimaryFilerHasCombatPay" />
          <GreaterThanOrEqual>
            <Left>
              <Dependency path="/eitcAmountWithPrimaryCombatPay" />
            </Left>
            <Right>
              <Dependency path="/eitcAmountWithoutCombatPay" />
            </Right>
          </GreaterThanOrEqual>
        </All>
      </Derived>
    </Fact>

    <Fact path="/isEITCAmountWithSecondaryCombatPayGreaterThanWithoutCombatPay">
      <Name>Is the EITC amount with secondary combat pay greater than without combat pay</Name>
      <Description>Whether or not the EITC amount with secondary combat pay is greater then without combat pay</Description>

      <Derived>
        <All>
          <Dependency module="formW2s" path="/onlyMFJSpouseHasCombatPay" />
          <GreaterThanOrEqual>
            <Left>
              <Dependency path="/eitcAmountWithSecondaryCombatPay" />
            </Left>
            <Right>
              <Dependency path="/eitcAmountWithoutCombatPay" />
            </Right>
          </GreaterThanOrEqual>
        </All>
      </Derived>
    </Fact>

    <Fact path="/isEITCAmountWithBothCombatPayMaximum">
      <Name>Is the EITC amount with both combat pay is maximum</Name>
      <Description>Whether or not the EITC amount with both combat pays is greater primary, secondary, and without
        combat pay</Description>

      <Derived>
        <All>
          <Dependency module="formW2s" path="/bothFilersHasCombatPay" />
          <Equal>
            <Left>
              <GreaterOf>
                <Dependency path="/eitcAmountWithBothTPCombatPay" />
                <Dependency path="/eitcAmountWithPrimaryCombatPay" />
                <Dependency path="/eitcAmountWithSecondaryCombatPay" />
                <Dependency path="/eitcAmountWithoutCombatPay" />
              </GreaterOf>
            </Left>
            <Right>
              <Dependency path="/eitcAmountWithBothTPCombatPay" />
            </Right>
          </Equal>
        </All>
      </Derived>
    </Fact>

    <Fact path="/isEITCAmountWithPrimaryCombatPayMaximum">
      <Name>Is the EITC amount with primary combat pay is maximum</Name>
      <Description>Whether or not the EITC amount with primary combat pay is greater secondary, both and without combat
        pay</Description>

      <Derived>
        <All>
          <Dependency module="formW2s" path="/bothFilersHasCombatPay" />
          <Equal>
            <Left>
              <GreaterOf>
                <Dependency path="/eitcAmountWithBothTPCombatPay" />
                <Dependency path="/eitcAmountWithPrimaryCombatPay" />
                <Dependency path="/eitcAmountWithSecondaryCombatPay" />
                <Dependency path="/eitcAmountWithoutCombatPay" />
              </GreaterOf>
            </Left>
            <Right>
              <Dependency path="/eitcAmountWithPrimaryCombatPay" />
            </Right>
          </Equal>
        </All>
      </Derived>
    </Fact>

    <Fact path="/isEITCAmountWithSecondaryCombatPayMaximum">
      <Name>Is the EITC amount with Secondary combat pay is maximum</Name>
      <Description>Whether or not the EITC amount with Secondary combat pay is greater secondary, both and without
        combat
        pay</Description>

      <Derived>
        <All>
          <Dependency module="formW2s" path="/bothFilersHasCombatPay" />
          <Equal>
            <Left>
              <GreaterOf>
                <Dependency path="/eitcAmountWithBothTPCombatPay" />
                <Dependency path="/eitcAmountWithPrimaryCombatPay" />
                <Dependency path="/eitcAmountWithSecondaryCombatPay" />
                <Dependency path="/eitcAmountWithoutCombatPay" />
              </GreaterOf>
            </Left>
            <Right>
              <Dependency path="/eitcAmountWithSecondaryCombatPay" />
            </Right>
          </Equal>
        </All>
      </Derived>
    </Fact>

    <Fact path="/combatPayRecommendation">
      <Name>Is the EITC amount with primary combat pay greater than without combat pay</Name>
      <Description>Whether or not the EITC amount with primary combat pay is greater then without combat pay</Description>

      <Derived>
        <Switch>

          <Case> <!-- EITC amt w/ primary combat pay is greater than or equal to EITC amount without combat pay -->
            <When>
              <Dependency path="/isEITCAmountWithPrimaryCombatPayGreaterThanWithoutCombatPay" />
            </When>
            <Then>
              <Enum optionsPath="/combatPayOptions">usePrimaryCombatPay</Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Dependency path="/isEITCAmountWithSecondaryCombatPayGreaterThanWithoutCombatPay" />
            </When>
            <Then>
              <Enum optionsPath="/combatPayOptions">useSpouseCombatPay</Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Dependency path="/isEITCAmountWithBothCombatPayMaximum" />
            </When>
            <Then>
              <Enum optionsPath="/combatPayOptions">useBothCombatPay</Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Dependency path="/isEITCAmountWithPrimaryCombatPayMaximum" />
            </When>
            <Then>
              <Enum optionsPath="/combatPayOptions">usePrimaryNotSpouseCombatPay</Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Dependency path="/isEITCAmountWithSecondaryCombatPayMaximum" />
            </When>
            <Then>
              <Enum optionsPath="/combatPayOptions">useSpouseNotPrimaryCombatPay</Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <True />
            </When>
            <Then>
              <Enum optionsPath="/combatPayOptions">noCombatPay</Enum>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/isCombatPayRecommendationUsePrimary">
      <Name>Is the combat pay election usePrimaryCombatPay</Name>
      <Description>Is the combat pay election useSpouseCombatPay</Description>

      <Derived>
        <Equal>
          <Left>
            <Dependency path="/combatPayRecommendation" />
          </Left>
          <Right>
            <Enum optionsPath="/combatPayOptions">usePrimaryCombatPay</Enum>
          </Right>
        </Equal>
      </Derived>
    </Fact>

    <Fact path="/isCombatPayRecommendationUseSpouse">
      <Name>Is the combat pay election useSpouseCombatPay</Name>
      <Description>Is the combat pay election useSpouseCombatPay</Description>

      <Derived>
        <Equal>
          <Left>
            <Dependency path="/combatPayRecommendation" />
          </Left>
          <Right>
            <Enum optionsPath="/combatPayOptions">useSpouseCombatPay</Enum>
          </Right>
        </Equal>
      </Derived>
    </Fact>

    <Fact path="/isCombatPayRecommendationUseBoth">
      <Name>Is the combat pay election useBothCombatPay</Name>
      <Description>Is the combat pay election useBothCombatPay</Description>

      <Derived>
        <Equal>
          <Left>
            <Dependency path="/combatPayRecommendation" />
          </Left>
          <Right>
            <Enum optionsPath="/combatPayOptions">useBothCombatPay</Enum>
          </Right>
        </Equal>
      </Derived>
    </Fact>

    <Fact path="/isCombatPayRecommendationNoCombatPay">
      <Name>Is the combat pay election noCombatPay</Name>
      <Description>Is the combat pay election noCombatPay</Description>

      <Derived>
        <Equal>
          <Left>
            <Dependency path="/combatPayRecommendation" />
          </Left>
          <Right>
            <Enum optionsPath="/combatPayOptions">noCombatPay</Enum>
          </Right>
        </Equal>
      </Derived>
    </Fact>

    <Fact path="/isCombatPayRecommendationUsePrimaryNotSpouse">
      <Name>Is the combat pay election usePrimaryNotSpouse</Name>
      <Description>Is the combat pay election usePrimaryNotSpouse</Description>

      <Derived>
        <Equal>
          <Left>
            <Dependency path="/combatPayRecommendation" />
          </Left>
          <Right>
            <Enum optionsPath="/combatPayOptions">usePrimaryNotSpouseCombatPay</Enum>
          </Right>
        </Equal>
      </Derived>
    </Fact>

    <Fact path="/isCombatPayRecommendationUseSpouseNotPrimary">
      <Name>Is the combat pay election useSpouseNotPrimary</Name>
      <Description>Is the combat pay election useSpouseNotPrimary</Description>

      <Derived>
        <Equal>
          <Left>
            <Dependency path="/combatPayRecommendation" />
          </Left>
          <Right>
            <Enum optionsPath="/combatPayOptions">useSpouseNotPrimaryCombatPay</Enum>
          </Right>
        </Equal>
      </Derived>
    </Fact>

    <Fact path="/combatPayElectionAndOrRecommendation">
      <Name>Combat pay election and/or recommendation</Name>
      <Description>Sets this fact to recommendation only if there is no election</Description>

      <Derived>
        <Switch>
          <Case>
            <When>
              <IsComplete>
                <Dependency path="/combatPayElection" />
              </IsComplete>
            </When>
            <Then>
              <Dependency path="/combatPayElection" />
            </Then>
          </Case>
          <Case>
            <When>
              <True />
            </When>
            <Then>
              <Dependency path="/combatPayRecommendation" />
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path='/hasManyEitcQualifyingChildren'>
      <Derived>
        <GreaterThan>
          <Left>
            <Dependency module="familyAndHousehold" path="/numEitcQualifyingChildren" />
          </Left>
          <Right>
            <Int> 1 </Int>
          </Right>
        </GreaterThan>
      </Derived>
    </Fact>
  </Facts>
</FactDictionaryModule>
